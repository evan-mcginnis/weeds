#!/bin/sh
#
# Create figures and tables for the dissertation
#
# Usage: create-dissertation-tex <data | tables | figures>
# default is all
#

if [ $# -eq 0 ]; then
	action=all
else
	action=$1
fi

# Use these lines for debug
BASE=/cygdrive/c/tmp/dissertation
DATA=/cygdrive/c/tmp/dissertation/data
# Use these lines for a real run
#BASE=../documents
#DATA=/cygdrive/d/dissertation-revision/data


# Use these lines for debug
#MAKE="make -n"
# Use this line for a real run
MAKE=make

# Prefix all generated files with this sequence
FILE_PREFIX=generated

# Output files
OUTSTDOUT=figures.out
OUTSTDERR=figures.err
# Truncate the files
touch $OUTSTDOUT
touch $OUTSTDERR
> $OUTSTDOUT
> $OUTSTDERR

# Exit if we hit an error
check_result(){
	if [ $? -ne 0 ] ; then
		echo "Error encountered. Exit"
		exit -1
	fi
}

#
# DATA
#

if [ $action = "data" ] || [ $action = "all" ]; then
echo "Phase 1 - Create Data in $BASE"
echo "Texture"
$MAKE optimal TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv FACTORS=4 PREFIX=cantaloupe_texture TYPE=TEXTURE SUBTYPE=all OUTPUT=$DATA >$OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
echo "GLCM"
$MAKE optimal TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv FACTORS=4 PREFIX=cantaloupe_glcm TYPE=TEXTURE SUBTYPE=GLCM OUTPUT=$DATA >> $OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
echo "LBP"
$MAKE optimal TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv FACTORS=4 PREFIX=cantaloupe_lbp TYPE=TEXTURE SUBTYPE=LBP OUTPUT=$DATA >> $OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
echo "COLOR"
$MAKE optimal TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv FACTORS=4 PREFIX=cantaloupe_color TYPE=COLOR SUBTYPE=all OUTPUT=$DATA >> $OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
echo "SHAPE"
$MAKE optimal TRAINING=/cygdrive/d/dissertation/shape/season.csv FACTORS=4 PREFIX=cantaloupe_shape TYPE=SHAPE SUBTYPE=all OUTPUT=$DATA >> $OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
echo "All"
$MAKE optimal TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv FACTORS=4 PREFIX=cantaloupe_all TYPE=all SUBTYPE=all OUTPUT=$DATA >> $OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
fi;

#
# TABLES
#

if [ $action = "tables" ] || [ $action = "all" ]; then
echo "Phase 2 - Create Tables in $BASE/tables"
echo ALL
$MAKE optimal-results TYPE=all SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using all features " CAPTION_SHORT="Classification using all features " LABEL=table:optimal-summary PREFIX=cantaloupe_all_auc OUTPUT=$BASE/tables/$FILE_PREFIX-results-optimal.tex COLUMNS="auc f1 precision recall" >>$OUTSTDOUT
$MAKE optimal-results TYPE=all SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using all features " CAPTION_SHORT="Classification using all features " LABEL=table:optimal-details PREFIX=cantaloupe_all_auc OUTPUT=$BASE/tables/$FILE_PREFIX-details-results-optimal.tex COLUMNS="auc parameters" >>$OUTSTDOUT
check_result

echo Texture
$MAKE optimal-results TYPE=TEXTURE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using texture " CAPTION_SHORT="Classification using texture " LABEL=table:texture-summary PREFIX=cantaloupe_texture_auc OUTPUT=$BASE/tables/$FILE_PREFIX-results-texture.tex COLUMNS="auc f1 precision recall" >>$OUTSTDOUT
check_result
$MAKE optimal-results TYPE=TEXTURE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using texture features " CAPTION_SHORT="Classification using texture features " LABEL=table:texture-details PREFIX=cantaloupe_texture_auc OUTPUT=$BASE/tables/$FILE_PREFIX-details-results-texture.tex COLUMNS="auc parameters" >>$OUTSTDOUT
check_result

echo GLCM
$MAKE optimal-results TYPE=TEXTURE SUBTYPE=GLCM FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using GLCM " CAPTION_SHORT="Classification using GLCM " LABEL=table:glcm-summary PREFIX=cantaloupe_glcm_auc OUTPUT=$BASE/tables/$FILE_PREFIX-results-glcm.tex COLUMNS="auc f1 precision recall" >>$OUTSTDOUT
check_result
$MAKE optimal-results TYPE=TEXTURE SUBTYPE=GLCM FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using GLCM " CAPTION_SHORT="Classification using GLCM " LABEL=table:glcm-details PREFIX=cantaloupe_glcm_auc OUTPUT=$BASE/tables/$FILE_PREFIX-details-results-glcm.tex COLUMNS="auc parameters" >>$OUTSTDOUT
check_result

echo LBP
$MAKE optimal-results TYPE=TEXTURE SUBTYPE=LBP FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using LBP " CAPTION_SHORT="Classification using LBP " LABEL=table:lbp-summary PREFIX=cantaloupe_lbp_auc OUTPUT=$BASE/tables/$FILE_PREFIX-results-lbp.tex COLUMNS="auc f1 precision recall" >>$OUTSTDOUT
check_result
$MAKE optimal-results TYPE=TEXTURE SUBTYPE=LBP FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using LBP " CAPTION_SHORT="Classification using LBP " LABEL=table:lbp-details PREFIX=cantaloupe_lbp_auc OUTPUT=$BASE/tables/$FILE_PREFIX-details-results-lbp.tex COLUMNS="auc parameters" >>$OUTSTDOUT
check_result

echo Color
$MAKE optimal-results TYPE=COLOR SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using color " CAPTION_SHORT="Classification using color " LABEL=table:color-summary PREFIX=cantaloupe_color_auc OUTPUT=$BASE/tables/$FILE_PREFIX-results-color.tex COLUMNS="auc f1 precision recall" >>$OUTSTDOUT
check_result
$MAKE optimal-results TYPE=COLOR SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using color " CAPTION_SHORT="Classification using color " LABEL=table:color-details PREFIX=cantaloupe_color_auc OUTPUT=$BASE/tables/$FILE_PREFIX-details-results-color.tex COLUMNS="auc parameters" >>$OUTSTDOUT
check_result

echo Shape
$MAKE optimal-results TYPE=SHAPE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using shape " CAPTION_SHORT="Classification using shape " LABEL=table:shape-summary PREFIX=cantaloupe_shape_auc OUTPUT=$BASE/tables/$FILE_PREFIX-results-shape.tex COLUMNS="auc f1 precision recall" >>$OUTSTDOUT
check_result
$MAKE optimal-results TYPE=SHAPE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using shape" CAPTION_SHORT="Classification using shape"  LABEL=table:shape-details PREFIX=cantaloupe_shape_auc OUTPUT=$BASE/tables/$FILE_PREFIX-details-results-shape.tex COLUMNS="auc parameters" >>$OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT

echo Counts

$MAKE optimal-counts TYPE=all SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=/cygdrive/c/tmp/dissertation/data CAPTION_LONG="Percentage of Classifications within %T of Maximum" CAPTION_SHORT="Percentage of Classifications within %T of maximum" LABEL=table:results-counts PREFIX=cantaloupe_all_auc OUTPUT=/cygdrive/c/tmp/dissertation/tables/$FILE_PREFIX-results-counts.tex THRESHOLD=0.03 >>$OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
$MAKE parameter-counts TYPE=TEXTURE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=/cygdrive/c/tmp/dissertation/data CAPTION_LONG="Counts of texture parameters used" CAPTION_SHORT="Counts of texture parameters used" LABEL=table:parameter-counts-texture PREFIX=cantaloupe_texture_auc OUTPUT=/cygdrive/c/tmp/dissertation/tables/$FILE_PREFIX-parameter-counts-texture.tex  >>$OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT
$MAKE parameter-counts TYPE=all SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=/cygdrive/c/tmp/dissertation/data CAPTION_LONG="Counts of parameters used" CAPTION_SHORT="Counts of parameters used" LABEL=table:parameter-counts-all PREFIX=cantaloupe_all_auc OUTPUT=/cygdrive/c/tmp/dissertation/tables/$FILE_PREFIX-parameter-counts-all.tex  >>$OUTSTDOUT
check_result
echo "--------" >> $OUTSTDOUT

echo Thresholds
make optimal-thresholds PREFIX=cantaloupe_all_auc PARAMETERS=parameters.pickle FORMAT=latex TYPE=all SUBTYPE=all LOGGING=tucson-logging.ini ALL_RESULTS=$DATA CAPTION_LONG="Thresholds for classification approaches"  CAPTION_SHORT="Thresholds for classification approaches" LABEL=table:thresholds TRAINING=/cygdrive/d/dissertation/shape/season.csv OUTPUT=$BASE/tables/$FILE_PREFIX-thresholds.tex >> $OUTSTDOUT
check_result

echo Seasonality - all
make optimal-results-seasonality SOURCE_CSV=/cygdrive/d/dissertation/shape/season.csv TYPE=all SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA CAPTION_LONG="Seasonality of Parameters - all features" CAPTION_SHORT="Seasonality of Parameters - all features" LABEL=table:seasonality-all PREFIX=cantaloupe_all OUTPUT=$BASE/tables/$FILE_PREFIX-seasonality-all.tex >>$OUTSTDOUT
check_result
echo Seasonality - texture
make optimal-results-seasonality SOURCE_CSV=/cygdrive/d/dissertation/cantaloupe/season.csv TYPE=TEXTURE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA CAPTION_LONG="Seasonality of Parameters - Texture" CAPTION_SHORT="Seasonality of Parameters - Texture" LABEL=table:seasonality-texture PREFIX=cantaloupe_texture OUTPUT=$BASE/tables/$FILE_PREFIX-seasonality-texture.tex >>$OUTSTDOUT
check_result
echo Seasonality - GLCM
make optimal-results-seasonality SOURCE_CSV=/cygdrive/d/dissertation/cantaloupe/season.csv TYPE=TEXTURE SUBTYPE=GLCM FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA CAPTION_LONG="Seasonality of Parametersi - GLCM" CAPTION_SHORT="Seasonality of Parameters - GLCM" LABEL=table:seasonality-glcm PREFIX=cantaloupe_glcm OUTPUT=$BASE/tables/$FILE_PREFIX-seasonality-glcm.tex >>$OUTSTDOUT
check_result
echo Seasonality - LBP
make optimal-results-seasonality SOURCE_CSV=/cygdrive/d/dissertation/cantaloupe/season.csv TYPE=TEXTURE SUBTYPE=LBP FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA CAPTION_LONG="Seasonality of Parameters - LBP" CAPTION_SHORT="Seasonality of Parameters - LBP" LABEL=table:seasonality-lbp PREFIX=cantaloupe_lbp OUTPUT=$BASE/tables/$FILE_PREFIX-seasonality-lbp.tex >>$OUTSTDOUT
check_result
echo Seasonality - color
make optimal-results-seasonality SOURCE_CSV=/cygdrive/d/dissertation/cantaloupe/season.csv TYPE=COLOR SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA CAPTION_LONG="Seasonality of Parameters - Color" CAPTION_SHORT="Seasonality of Parameters - Color" LABEL=table:seasonality-color PREFIX=cantaloupe_color OUTPUT=$BASE/tables/$FILE_PREFIX-seasonality-color.tex >>$OUTSTDOUT
check_result
echo Seasonality - shape
make optimal-results-seasonality SOURCE_CSV=/cygdrive/d/dissertation/shape/season.csv TYPE=SHAPE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA CAPTION_LONG="Seasonality of Parameters - Shape" CAPTION_SHORT="Seasonality of Parameters - Shape" LABEL=table:seasonality-shape PREFIX=cantaloupe_shape OUTPUT=$BASE/tables/$FILE_PREFIX-seasonality-shape.tex >>$OUTSTDOUT
check_result

fi

#
# FIGURES
# 

if [ $action = "figures" ] || [ $action = "all" ]; then
echo "Phase 3 - Create Figures"
echo "ROC for all - binary"
$MAKE optimal-roc TYPE=all SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using all features (binary)" CAPTION_SHORT="Classification using all features (binary)" LABEL=table:optimal PREFIX=cantaloupe_all_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-all.png COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for all - unary"
$MAKE optimal-roc TYPE=all SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using all features (unary)" CAPTION_SHORT="Classification using all features (unary)" LABEL=table:optimal PREFIX=cantaloupe_all_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-all-occ.png APPROACH=occ COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for texture - binary"
$MAKE optimal-roc TYPE=TEXTURE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using texture (binary)" CAPTION_SHORT="Classification using texture (binary)" LABEL=table:optimal PREFIX=cantaloupe_texture_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-texture.png COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for texture - unary"
$MAKE optimal-roc TYPE=TEXTURE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using texture (unary)" CAPTION_SHORT="Classification using texture (unary)" LABEL=table:optimal PREFIX=cantaloupe_texture_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-texture-occ.png APPROACH=occ COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for GLCM - binary"
$MAKE optimal-roc TYPE=TEXTURE SUBTYPE=GLCM FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using GLCM (binary)" CAPTION_SHORT="Classification using GLCM (binary)" LABEL=table:optimal PREFIX=cantaloupe_glcm OUTPUT=$BASE/figures/$FILE_PREFIX-roc-glcm.png COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for GLCM - unary"
$MAKE optimal-roc TYPE=TEXTURE SUBTYPE=GLCM FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using GLCM (unary)" CAPTION_SHORT="Classification using GLCM (unary)" LABEL=table:optimal PREFIX=cantaloupe_glcm_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-glcm-occ.png APPROACH=occ COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for LBP - binary"
$MAKE optimal-roc TYPE=TEXTURE SUBTYPE=LBP FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using LBP (binary)" CAPTION_SHORT="Classification using LBP (binary)" LABEL=table:optimal PREFIX=cantaloupe_lbp_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-lbp.png COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for LBP - unary"
$MAKE optimal-roc TYPE=TEXTURE SUBTYPE=GLCM FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using LBP (unary)" CAPTION_SHORT="Classification using LBP (unary)" LABEL=table:optimal PREFIX=cantaloupe_lbp_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-lbp-occ.png APPROACH=occ COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for color - binary"
$MAKE optimal-roc TYPE=COLOR SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using color (binary)" CAPTION_SHORT="Classification using color (binary)" LABEL=table:optimal PREFIX=cantaloupe_color_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-color.png COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for color - unary"
$MAKE optimal-roc TYPE=COLOR SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using color (unary)" CAPTION_SHORT="Classification using color (unary)" LABEL=table:optimal PREFIX=cantaloupe_color_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-color-occ.png APPROACH=occ COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/cantaloupe/season.csv >>$OUTSTDOUT
check_result
echo "ROC for shape - binary"
$MAKE optimal-roc TYPE=SHAPE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using shape (binary)" CAPTION_SHORT="Classification using shape (binary)" LABEL=table:optimal PREFIX=cantaloupe_shape_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-shape.png COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/shape/season.csv >>$OUTSTDOUT
check_result
echo "ROC for shape - unary"
$MAKE optimal-roc TYPE=SHAPE SUBTYPE=all FORMAT=latex PARAMETERS=parameters.pickle LOGGING=tucson-logging.ini ALL_RESULTS=$DATA/ CAPTION_LONG="Classification using shape (unary)" CAPTION_SHORT="Classification using shape (unary)" LABEL=table:optimal PREFIX=cantaloupe_shape_auc OUTPUT=$BASE/figures/$FILE_PREFIX-roc-shape-occ.png APPROACH=occ COLUMNS="auc f1 precision recall" TRAINING=/cygdrive/d/dissertation/shape/season.csv >>$OUTSTDOUT
check_result
fi;
exit 0

